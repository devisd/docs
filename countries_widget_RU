# Countries5YearsWidget

Компонент `Countries5YearsWidget` представляет собой React-компонент, который предназначен для выбора периода времени и списка стран. Компонент использует библиотеки `react-hook-form` для управления формой и `react-select` для реализации выпадающих списков.

## Пропсы

### Обязательные пропсы

- **name**: строка - уникальное имя для компонента в контексте формы.
- **widget**: объект - содержит информацию о виджете, такую как конечная точка для запроса данных.
- **choices**: строка - строка, содержащая информацию о возможных выборах (периодах и странах).

### Дополнительные пропсы

- **IDynamicComponent**: интерфейс, предоставляющий дополнительные свойства для динамических компонентов.
- **IWidget**: интерфейс, предоставляющий свойства для виджетов.

## Структура компонента

1. **Импорт зависимостей и стилей**
   - `useEffect`, `useMemo`, `useState` - хуки React.
   - `Controller`, `useFormContext` - хуки из библиотеки `react-hook-form`.
   - `IWidget`, `IDynamicComponent` - интерфейсы для типизации пропсов.
   - `useLocale` - хук для получения текущей локали.
   - `request` - функция для отправки запросов на сервер.
   - `Button`, `Select`, `IconNo` - компоненты для отображения кнопок, выпадающих списков и иконок.
   - `FIELD_NAME` - константа с именем поля формы.

2. **Тип данных для ответа от сервера**
   - `CountriesResponse`: объект, представляющий ответ от сервера с информацией о странах.

3. **Функциональный компонент `Countries5YearsWidget`**
   - **Получение текущей локали и функции перевода** (`useLocale`, `translation`).
   - **Доступ к контексту формы** (`useFormContext`).
   - **Парсинг строки выборов** (`parseChoices`): извлечение периодов и стран из строки выборов.
   - **Установка начального состояния на основе выборов** (`initialSelectedFields`).
   - **Стейты для выбранных полей, доступных стран и лет** (`selectedFields`, `availableCountries`).
   - **Генерация массива лет для компонента `Select`** (`years`, `opt`).
   - **Запрос данных о странах с сервера** (`useEffect`).

4. **Обработчики событий**
   - **Добавление нового поля** (`handleAddField`).
   - **Удаление поля** (`handleRemoveField`).
   - **Изменение года** (`handleYearChange`).
   - **Изменение списка стран** (`handleCountriesChange`).

5. **Вспомогательные функции**
   - **Генерация строки вывода на основе выбранных полей** (`generateOutputString`).
   - **Получение доступных стран на основе выбранных полей** (`getAvailableCountries`).
   - **Генерация опций для выбора лет в компоненте `Select`** (`generateYearOptions`).

6. **Отрисовка компонента**
   - **Использование `Controller` из `react-hook-form`**.
   - **Отображение выпадающих списков для выбора лет и стран**.
   - **Возможность добавления и удаления полей**.
   - **Обработка ошибок и отображение кнопки для добавления нового поля**.

Компонент предоставляет пользователю интерфейс для выбора периода и списка стран с использованием динамической формы.
